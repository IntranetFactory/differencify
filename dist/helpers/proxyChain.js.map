{"version":3,"sources":["../../src/helpers/proxyChain.js"],"names":["ChainObject","constructor","target","options","currentTarget","actions","setCurrentTarget","addAction","property","undefined","args","push","end","result","continueChain","action","_handleContinueFunc","continueFunc","resultFunc","apply","funcHandler","makeHandler","get","chainObj","chained","moduleList","includes","handle","arguments","endFunc","then","catch","e","logger","trace","chainedTarget","set","name","value","Error","chain","defaultParams","chainObject","Proxy","module","exports"],"mappings":"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","file":"proxyChain.js","sourcesContent":["/* eslint-disable prefer-rest-params, no-await-in-loop */\r\nimport logger from '../utils/logger';\r\nimport moduleList from './moduleList';\r\n\r\nclass ChainObject {\r\n  constructor(target, options) {\r\n    this.target = target;\r\n    this.options = options;\r\n    this.currentTarget = 'page';\r\n    this.actions = [];\r\n  }\r\n\r\n  setCurrentTarget(currentTarget) {\r\n    this.currentTarget = currentTarget;\r\n  }\r\n\r\n  addAction({\r\n    target = this.currentTarget,\r\n    property = undefined,\r\n    args = undefined,\r\n  } = {}) {\r\n    this.actions.push({ target, property, args });\r\n  }\r\n\r\n  async end() {\r\n    let result = null;\r\n    let continueChain = false;\r\n    const { actions } = this;\r\n    this.actions = [];\r\n    // eslint-disable-next-line no-restricted-syntax\r\n    for (const action of actions) {\r\n      if (continueChain) {\r\n        result = await this.target._handleContinueFunc(result, action.property, action.args);\r\n        continueChain = false;\r\n      } else if (action.property === this.options.continueFunc) {\r\n        continueChain = true;\r\n      } else if (action.property === this.options.resultFunc) {\r\n        result = await action.args[0].apply(null, [result]);\r\n      } else {\r\n        result = await this.target[this.options.funcHandler](action.target, action.property, action.args);\r\n      }\r\n    }\r\n    return result;\r\n  }\r\n}\r\n\r\nconst makeHandler = (target, options) => ({\r\n  get: (chainObj, property) => {\r\n    if (!options.chained) {\r\n      return (moduleList.includes(property))\r\n        ? target[options.funcHandler]('page', property)\r\n        : function handle() {\r\n          return target[options.funcHandler]('page', property, arguments);\r\n        };\r\n    }\r\n    if (property === options.endFunc) {\r\n      return () => chainObj.end()\r\n        .then(result => result)\r\n        .catch((e) => {\r\n          logger.trace(e);\r\n          throw e;\r\n        });\r\n    }\r\n    if (moduleList.includes(property)) {\r\n      chainObj.setCurrentTarget(property);\r\n      return target.chainedTarget;\r\n    }\r\n    if (property === options.continueFunc) {\r\n      chainObj.addAction({ property });\r\n      return target.chainedTarget;\r\n    }\r\n    return function handle() {\r\n      chainObj.addAction({ property, args: arguments });\r\n      return this;\r\n    };\r\n  },\r\n  set: (chainObj, name, value) => {\r\n    throw new Error(`You cannot set a ${value} to Proxy object.`);\r\n  },\r\n});\r\n\r\nconst chain = (target, chained = true) => {\r\n  const defaultParams = {\r\n    resultFunc: 'result',\r\n    endFunc: 'end',\r\n    continueFunc: 'then',\r\n    funcHandler: '_handleFunc',\r\n    chained,\r\n  };\r\n  const chainObject = new ChainObject(target, defaultParams);\r\n  return new Proxy(\r\n    chainObject,\r\n    makeHandler(target, defaultParams),\r\n  );\r\n};\r\n\r\nmodule.exports = chain;\r\n"]}