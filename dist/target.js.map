{"version":3,"sources":["../src/target.js"],"names":["Target","constructor","browser","globalConfig","testConfig","chainedTarget","page","prefixedLogger","logger","prefix","testName","imageType","error","image","testId","result","_logError","trace","_logStep","functionName","log","launch","options","puppeteer","newWindow","Error","connect","newPage","mockRequests","mockeerOptions","Object","assign","type","_handleContinueFunc","target","property","args","_handleFunc","screenshot","capture","warn","wait","value","waitFor","execute","expression","evaluate","resize","viewport","setViewport","freezeImage","selector","strFunc","isJest","expect","getState","testStats","currentTestName","testPath","isUpdate","snapshotState","_updateSnapshot","toMatchSnapshot","callback","resultCallback","testNameProvided","_evaluateResult","testResult","toMatchImageSnapshot","jestMatchers","extend","matched","updated","added","toNotError","close","module","exports"],"mappings":"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","file":"target.js","sourcesContent":["import puppeteer from 'puppeteer';\r\nimport recorder from 'mockeer';\r\nimport logger from './utils/logger';\r\nimport jestMatchers from './utils/jestMatchers';\r\nimport compareImage from './compareImage';\r\nimport functionToString from './helpers/functionToString';\r\nimport freezeImage from './freezeImage';\r\nimport { isFunc, handleAsyncFunc } from './helpers/functions';\r\n\r\nexport default class Target {\r\n  constructor(browser, globalConfig, testConfig) {\r\n    this.globalConfig = globalConfig;\r\n    this.testConfig = testConfig;\r\n    this.browser = browser;\r\n    this.chainedTarget = null;\r\n    this.page = null;\r\n    this.prefixedLogger = logger.prefix(this.testConfig.testName);\r\n    this.testConfig.imageType = globalConfig.imageType;\r\n    this.error = null;\r\n    this.image = null;\r\n    this.testId = 0;\r\n    this.result = null;\r\n  }\r\n\r\n  _logError(error) {\r\n    this.error = error;\r\n    this.prefixedLogger.trace(error);\r\n  }\r\n\r\n  _logStep(functionName) {\r\n    this.prefixedLogger.log(`Executing ${functionName} step`);\r\n  }\r\n\r\n  async launch(options) {\r\n    try {\r\n      this.prefixedLogger.log('Launching browser...');\r\n      this.browser = await puppeteer.launch(options);\r\n      this.testConfig.newWindow = true;\r\n    } catch (error) {\r\n      this._logError(error);\r\n      throw new Error('Failed to launch the browser');\r\n    }\r\n    return this.browser;\r\n  }\r\n\r\n  async connect(options) {\r\n    try {\r\n      this.prefixedLogger.log('Launching browser...');\r\n      this.browser = await puppeteer.connect(options);\r\n      this.testConfig.newWindow = true;\r\n    } catch (error) {\r\n      this._logError(error);\r\n      throw new Error('Failed to launch the browser');\r\n    }\r\n    return this.browser;\r\n  }\r\n\r\n  async newPage() {\r\n    try {\r\n      this.page = await this.browser.newPage();\r\n    } catch (error) {\r\n      this._logError(error);\r\n    }\r\n    return this.page;\r\n  }\r\n\r\n  async mockRequests(options) {\r\n    if (!this.error) {\r\n      try {\r\n        const mockeerOptions = Object.assign({}, options, { page: this.page }); // eslint-disable-line prefer-object-spread/prefer-object-spread\r\n        await recorder(this.browser, mockeerOptions);\r\n        this.testConfig.imageType = (options && options.type) || 'png';\r\n        return this.image;\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async _handleContinueFunc(target, property, args) {\r\n    if (!this.error) {\r\n      try {\r\n        this._logStep(property);\r\n        return isFunc(target[property]) ? await target[property](...args) : await target[property];\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _handleFunc(target, property, args) {\r\n    if (!this.error) {\r\n      try {\r\n        this._logStep(`${target}.${property}`);\r\n        if (target === 'page') {\r\n          if (this[property]) {\r\n            return isFunc(this[property]) ? handleAsyncFunc(this, property, args) : this[property];\r\n          }\r\n          return isFunc(this.page[property]) ? handleAsyncFunc(this.page, property, args) : this.page[property];\r\n        }\r\n        return isFunc(this.page[target][property])\r\n          ? handleAsyncFunc(this.page[target], property, args)\r\n          : this.page[target][property];\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async screenshot(options) {\r\n    if (!this.error) {\r\n      try {\r\n        this.image = await this.page.screenshot(options);\r\n        this.testConfig.imageType = (options && options.type) || 'png';\r\n        return this.image;\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async capture(options) {\r\n    if (!this.error) {\r\n      try {\r\n        logger.warn(\r\n          `capture() will be deprecated, use screenshot() instead.\r\n          Please read the API docs at https://github.com/NimaSoroush/differencify`,\r\n        );\r\n        this.image = await this.page.screenshot(options);\r\n        this.testConfig.imageType = (options && options.type) || 'png';\r\n        return this.image;\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async wait(value) {\r\n    if (!this.error) {\r\n      try {\r\n        logger.warn(\r\n          `wait() will be deprecated, use waitFor() instead.\r\n          Please read the API docs at https://github.com/NimaSoroush/differencify`,\r\n        );\r\n        return await this.page.waitFor(value);\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async execute(expression) {\r\n    if (!this.error) {\r\n      try {\r\n        logger.warn(\r\n          `execute() will be deprecated, use evaluate() instead.\r\n          Please read the API docs at https://github.com/NimaSoroush/differencify`,\r\n        );\r\n        return await this.page.evaluate(expression);\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async resize(viewport) {\r\n    if (!this.error) {\r\n      try {\r\n        logger.warn(\r\n          `resize() will be deprecated, use setViewport() instead.\r\n          Please read the API docs at https://github.com/NimaSoroush/differencify`,\r\n        );\r\n        return await this.page.setViewport(viewport);\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  async freezeImage(selector) {\r\n    if (!this.error) {\r\n      try {\r\n        const strFunc = functionToString(freezeImage, selector);\r\n        const result = await this.page.evaluate(strFunc);\r\n        this.prefixedLogger.log(`Freezing image ${selector} in browser`);\r\n        if (!result) {\r\n          this._logError(`Unable to freeze image with selector ${selector}`);\r\n        }\r\n        return result;\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  isJest() {\r\n    try {\r\n      this.testConfig.isJest = (expect && isFunc(expect.getState));\r\n      if (this.testConfig.isJest) {\r\n        this.testStats = expect.getState() || null;\r\n        this.prefixedLogger = logger.prefix(this.testStats.currentTestName);\r\n        this.testConfig.testPath = this.testStats.testPath;\r\n        this.testConfig.isUpdate = this.testStats.snapshotState._updateSnapshot === 'all' || false;\r\n      } else {\r\n        this.testId = this.testConfig.testId;\r\n      }\r\n    } catch (error) {\r\n      this.testConfig.isJest = false;\r\n      this.testId = this.testConfig.testId;\r\n    }\r\n  }\r\n\r\n  async toMatchSnapshot(image, callback) {\r\n    let resultCallback;\r\n    if (image && !isFunc(image)) {\r\n      this.image = image;\r\n    } else if (isFunc(image)) {\r\n      resultCallback = image;\r\n    }\r\n    if (callback && isFunc(callback)) {\r\n      resultCallback = callback;\r\n    }\r\n    if (this.testConfig.isJest && !this.testConfig.testNameProvided) {\r\n      this.testConfig.testName = this.testStats.currentTestName;\r\n    } else {\r\n      this.testConfig.testName = this.testConfig.testName;\r\n    }\r\n    this.testId += 1;\r\n    const result = await this._evaluateResult();\r\n    if (resultCallback) {\r\n      resultCallback({\r\n        testConfig: this.testConfig,\r\n        testResult: this.result,\r\n      });\r\n    }\r\n    return result;\r\n  }\r\n\r\n  async _evaluateResult() {\r\n    if (!this.error) {\r\n      try {\r\n        this.result = await compareImage(this.image, this.globalConfig, this.testConfig);\r\n      } catch (error) {\r\n        this._logError(error);\r\n      }\r\n      if (this.error) {\r\n        return false;\r\n      }\r\n      if (this.testConfig.isJest === true) {\r\n        const { toMatchImageSnapshot } = jestMatchers;\r\n        expect.extend({ toMatchImageSnapshot });\r\n        expect(this.result).toMatchImageSnapshot(this.testStats);\r\n      }\r\n      if (this.result.matched || this.result.updated || this.result.added) {\r\n        return true;\r\n      }\r\n    }\r\n    if (this.testConfig.isJest && this.error) {\r\n      const { toNotError } = jestMatchers;\r\n      expect.extend({ toNotError });\r\n      expect(this.error).toNotError(this.testStats);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  async close() {\r\n    if (!this.error) {\r\n      try {\r\n        if (this.testConfig.newWindow) {\r\n          await this.browser.close();\r\n        } else {\r\n          await this.page.close();\r\n        }\r\n      } catch (error) {\r\n        this._logError(error);\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  }\r\n}\r\n\r\nmodule.exports = Target;\r\n"]}